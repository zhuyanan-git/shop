<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<meta charset="utf-8">
<head th:include="include :: header">

</head>
<body class="gray-bg">
<div class="container-div">
    <!--表格行元素的对象增删改查-->
    <script type="text/html" id="barSeller">
        <a class="layui-btn layui-btn-sm" lay-event="edit">审核</a>
        <a class="layui-btn layui-btn-danger layui-btn-sm" lay-event="delete">删除</a>
    </script>

    <div class="row">
        <table id="seller" lay-filter="seller"></table>
    </div>
</div>

<div th:include="include :: footer"></div>
<script type="text/html" id="statusTemp">
    <a  class="layui-btn layui-btn-sm" lay-event="isdelete">删除</a>
</script>
<script>
    $(function () {
        sellerManage()
    });

    function sellerManage() {
        layui.use('table', function () {
            var table = layui.table;

            table.render({
                elem: '#seller'
                , height: 480
                , toolbar: '#toolbarSeller'
                , url: '/seller/list/' //数据接口
                , page: true //开启分页
                , cols: [
                    [ //表头
                        {field: 'id', title: 'ID', width: 50, sort: true, fixed: 'left'},
                        {field: 'name', title: '姓名', width: 80, fixed: 'left'},
                        {field: 'storename', title: '门店名称', width: 150, fixed: 'left'},
                        {field: 'phone', title: '电话', width: 100, fixed: 'left', templet: '#typeTpl'},
                        {field: 'openid', title: 'openid', width: 150, sort: true, fixed: 'left'},
                        {field: 'storeid', title: '门店ID', width: 50, fixed: 'left'},
                        {
                            field: 'bindtime',
                            title: '绑定时间',
                            width: 200,
                            fixed: 'left'
                        },
                        {
                            field: 'audittime', 
                            title: '审核时间', 
                            width: 200,
                            fixed: 'left'
                        },
                        {
                            field: 'status',
                            title: '审核状态',
                            width: 100,
                            align: 'center',
                            fixed: 'left',
                            templet:function(d){
                                if(d.status=='0'){
                                    return '未审核';
                                }else if(d.status=='1') {
                                    return '审核通过'
                                }else {
                                    return '审核未通过';
                                }
                            }
                        },
                        {
                            field: 'isdelete',
                            title: '是否删除',
                            align: 'center',
                            width: 100,
                            fixed: 'left',
                            templet:'#statusTemp'
                        },
                        {
                            field: 'online',
                            title: '是否在线',
                            align: 'center',
                            width: 100,
                            fixed: 'left',
                            templet:function (d) {
                                if(d.online=='1'){
                                    return '在线';
                                }else {
                                    return '离开';
                                }

                            }
                        },
                        {field: 'action', width: 200, title: '操作', align: 'center', toolbar: '#barSeller'}
                    ]
                ]
            });
            table.on('tool(seller)', function (obj) { //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
                var data = obj.data; //获得当前行数据
                var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                var tr = obj.tr; //获得当前行 tr 的DOM对象

                if (layEvent === 'delete') { //删除
                    layer.confirm('您确定删除这条数据吗？', function (index) {
                        var id = data.id;
                        $.post("/seller/delete", {id: id}, function (result) {
                            if (result.success) {
                                layer.alert("删除成功", function () {
                                    window.location.reload();
                                });
                            } else {
                                layer.alert("删除失败");
                            }
                        })
                    });
                }else if(layEvent === 'edit'){ //修改
                    layer.open({
                        type: 2,
                        title: '审核店员页面',
                        area: ['500px', '50%'],
                        content: '/seller/edit?id='+ data.id, //iframe的url
                        end: function () {
                            sellerManage();
                        }
                    });
                }else if(layEvent ==='isdelete'){
                    layer.confirm('您确定消除这条数据吗？', function (index) {
                        var id = data.id;
                        var isdelete='';
                        $.post("/seller/editIsdelete", {id: id,isdelete:'1'}, function (result) {
                            if (result.success) {
                                layer.alert("消除成功", function () {
                                    window.location.reload();
                                });
                            } else {
                                layer.alert("消除失败");
                            }
                        })
                    });
                }
            });
        });
    }


</script>
</body>
</html>